---
version: "3.7"

services:
  web:
    image: blossomlabs/blobscan:local
    build: .
    command: web
    restart: always
    ports:
      - 23000:3000
      - 25556:5556
    environment:
      DATABASE_URL: postgresql://blobscan:s3cr3t@postgres:5432/blobscan_dev?schema=public
      NEXTAUTH_URL: http://localhost:23000
      NEXT_PUBLIC_BEACON_BASE_URL: http://134.209.87.158:8080/
      NEXT_PUBLIC_EXPLORER_BASE_URL: https://explorer.4844-devnet-5.etpandaops.io/
    depends_on:
      - api

  api:
    image: blossomlabs/blobscan:local
    build: .
    command: api
    restart: always
    ports:
      - 23001:3001
    environment:
      DATABASE_URL: postgresql://blobscan:s3cr3t@postgres:5432/blobscan_dev?schema=public
      BLOBSCAN_API_PORT: 3001
      NEXTAUTH_SECRET: supersecret
    depends_on:
      - postgres

  indexer:
    image: blossomlabs/blobscan-indexer:master
    network_mode: host
    restart: always
    environment:
      SECRET_KEY: supersecret
      BLOBSCAN_API_ENDPOINT: http://localhost:23001
      BEACON_NODE_RPC: http://localhost:5052
      EXECUTION_NODE_URL: http://localhost:8545
    depends_on:
      - api

  postgres:
    image: postgres:14
    ports:
      - 5432:5432
    volumes:
      - postgres-data:/var/lib/postgresql/data
    environment:
      - POSTGRES_USER=blobscan
      - POSTGRES_DB=blobscan_dev
      - POSTGRES_PASSWORD=s3cr3t

volumes:
  postgres-data:
